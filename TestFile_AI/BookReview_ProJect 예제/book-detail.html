<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>도서 상세 - BookReview</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Guide Comment Toggle Button -->
    <div class="guide-toggle-container">
        <button class="guide-toggle-btn" id="guideToggleBtn">
            <i class="fas fa-info-circle"></i> 가이드 활용 설명 보기
        </button>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <h1><a href="index.html"><i class="fas fa-book"></i> BookReview</a></h1>
            <nav>
                <a href="index.html"><i class="fas fa-home"></i> 홈</a>
                <a href="books.html"><i class="fas fa-book-open"></i> 도서 목록</a>
                <a href="my-reviews.html"><i class="fas fa-star"></i> 내 리뷰</a>
                <div class="user-menu">
                    <span id="userGreeting" class="user-greeting" style="display: none;"></span>
                    <a href="login.html" id="loginBtn" class="login-btn"><i class="fas fa-sign-in-alt"></i> 로그인</a>
                    <a href="register.html" id="registerBtn" class="register-btn"><i class="fas fa-user-plus"></i> 회원가입</a>
                    <button id="logoutBtn" class="logout-btn" style="display: none;"><i class="fas fa-sign-out-alt"></i> 로그아웃</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Breadcrumb -->
        <section class="breadcrumb">
            <div class="container">
                <a href="index.html">홈</a>
                <i class="fas fa-chevron-right"></i>
                <a href="books.html">도서 목록</a>
                <i class="fas fa-chevron-right"></i>
                <span id="breadcrumbTitle">도서 상세</span>
            </div>
        </section>

        <!-- Book Detail Section -->
        <section class="book-detail-section">
            <div class="container">
                <!-- Loading -->
                <div id="bookLoading" class="loading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>도서 정보를 불러오는 중...</p>
                </div>

                <!-- Book Not Found -->
                <div id="bookNotFound" class="empty-state" style="display: none;">
                    <i class="fas fa-search"></i>
                    <h3>도서를 찾을 수 없습니다</h3>
                    <p>요청하신 도서가 존재하지 않거나 삭제되었습니다.</p>
                    <a href="books.html" class="btn-primary">
                        <i class="fas fa-arrow-left"></i> 도서 목록으로 돌아가기
                    </a>
                </div>

                <!-- Book Detail Content -->
                <div id="bookDetailContent" style="display: none;">
                    <div class="book-detail-header">
                        <div class="book-cover-large">
                            <i class="fas fa-book"></i>
                        </div>
                        
                        <div class="book-detail-info">
                            <h1 id="bookTitle" class="book-detail-title"></h1>
                            <div class="book-detail-meta">
                                <p class="book-author">
                                    <i class="fas fa-user-edit"></i>
                                    <span id="bookAuthor"></span>
                                </p>
                                <p class="book-publisher" id="bookPublisherInfo" style="display: none;">
                                    <i class="fas fa-building"></i>
                                    <span id="bookPublisher"></span>
                                </p>
                                <p class="book-genre" id="bookGenreInfo" style="display: none;">
                                    <i class="fas fa-tag"></i>
                                    <span id="bookGenre"></span>
                                </p>
                                <p class="book-date" id="bookDateInfo" style="display: none;">
                                    <i class="fas fa-calendar"></i>
                                    <span id="bookPublishDate"></span>
                                </p>
                            </div>
                            
                            <div class="book-rating-summary">
                                <div class="rating-display">
                                    <div class="rating-stars" id="bookRatingStars">
                                        <!-- 별점이 여기에 표시됩니다 -->
                                    </div>
                                    <div class="rating-info">
                                        <span class="rating-score" id="bookAverageRating">0.0</span>
                                        <span class="rating-count">(<span id="bookReviewCount">0</span>개 리뷰)</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Guide Comment: Book Detail Structure -->
                            <div class="guide-comment" data-section="book-detail">
                                <div class="guide-comment-header">
                                    <i class="fas fa-graduation-cap"></i>
                                    <strong>가이드 활용: 도서 상세 페이지</strong>
                                </div>
                                <div class="guide-comment-content">
                                    <p><strong>참조:</strong> data.js의 getBookById(), getBookAverageRating(), getBookReviews() 함수</p>
                                    <ul>
                                        <li>✅ URL 파라미터로 bookId 추출</li>
                                        <li>✅ 가이드 Books 테이블 필드 완전 표시</li>
                                        <li>✅ 평균 평점 계산 알고리즘 적용</li>
                                        <li>✅ 리뷰 개수 카운팅 함수 활용</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="book-actions">
                                <button id="writeReviewBtn" class="btn-primary">
                                    <i class="fas fa-star"></i> 리뷰 작성
                                </button>
                                <button id="editBookBtn" class="btn-secondary" style="display: none;">
                                    <i class="fas fa-edit"></i> 도서 수정
                                </button>
                                <button id="deleteBookBtn" class="btn-danger" style="display: none;">
                                    <i class="fas fa-trash"></i> 도서 삭제
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="book-description" id="bookDescriptionSection" style="display: none;">
                        <h3><i class="fas fa-info-circle"></i> 도서 소개</h3>
                        <div class="description-content" id="bookDescription"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Reviews Section -->
        <section class="book-reviews-section" id="bookReviewsSection" style="display: none;">
            <div class="container">
                <div class="reviews-header">
                    <h3><i class="fas fa-comments"></i> 리뷰 <span id="reviewsCount">(0)</span></h3>
                    <div class="reviews-controls">
                        <select id="reviewsSortBy">
                            <option value="newest">최신순</option>
                            <option value="oldest">오래된순</option>
                            <option value="rating-high">평점 높은순</option>
                            <option value="rating-low">평점 낮은순</option>
                        </select>
                        <button id="writeReviewBtn2" class="btn-primary">
                            <i class="fas fa-plus"></i> 리뷰 작성
                        </button>
                    </div>
                </div>

                <!-- Guide Comment: Reviews System -->
                <div class="guide-comment" data-section="reviews-system">
                    <div class="guide-comment-header">
                        <i class="fas fa-graduation-cap"></i>
                        <strong>가이드 활용: 리뷰 시스템</strong>
                    </div>
                    <div class="guide-comment-content">
                        <p><strong>참조:</strong> data.js의 getBookReviews(), sortReviews() 함수</p>
                        <ul>
                            <li>✅ bookId로 해당 도서 리뷰만 필터링</li>
                            <li>✅ 가이드 Reviews 테이블 구조 완전 표시</li>
                            <li>✅ 4가지 정렬 옵션 구현</li>
                            <li>✅ 사용자별 리뷰 수정/삭제 권한 확인</li>
                        </ul>
                    </div>
                </div>

                <!-- Loading -->
                <div id="reviewsLoading" class="loading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>리뷰를 불러오는 중...</p>
                </div>

                <!-- Reviews List -->
                <div class="reviews-list" id="reviewsList">
                    <!-- 리뷰들이 여기에 동적으로 추가됩니다 -->
                </div>

                <!-- Load More Reviews -->
                <div class="load-more-section" id="loadMoreSection" style="display: none;">
                    <button id="loadMoreReviewsBtn" class="btn-secondary">
                        <i class="fas fa-plus"></i> 더 많은 리뷰 보기
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>BookReview</h4>
                    <p>독서를 사랑하는 모든 이들을 위한 공간</p>
                </div>
                <div class="footer-section">
                    <h4>바로가기</h4>
                    <ul>
                        <li><a href="index.html">홈</a></li>
                        <li><a href="books.html">도서 목록</a></li>
                        <li><a href="my-reviews.html">내 리뷰</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>팀 정보</h4>
                    <p>📧 contact@bookreview.com</p>
                    <p>📞 02-1234-5678</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 BookReview Team. Made with ❤️</p>
            </div>
        </div>
    </footer>

    <!-- Write Review Modal -->
    <div class="modal-overlay" id="writeReviewModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-star"></i> 리뷰 작성</h3>
                <button class="modal-close" id="closeWriteReviewModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="modal-body" id="writeReviewForm">
                <div class="form-group">
                    <label>책 정보</label>
                    <div class="book-info-display" id="writeBookInfo">
                        <!-- 책 정보가 여기에 표시됩니다 -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="writeRating">평점 *</label>
                    <div class="rating-input">
                        <div class="star-rating" id="writeStarRating">
                            <span class="star" data-rating="1"><i class="far fa-star"></i></span>
                            <span class="star" data-rating="2"><i class="far fa-star"></i></span>
                            <span class="star" data-rating="3"><i class="far fa-star"></i></span>
                            <span class="star" data-rating="4"><i class="far fa-star"></i></span>
                            <span class="star" data-rating="5"><i class="far fa-star"></i></span>
                        </div>
                        <input type="hidden" id="writeRating" name="rating" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="writeContent">리뷰 내용 *</label>
                    <textarea id="writeContent" name="content" rows="5" required 
                              placeholder="이 책에 대한 생각을 자유롭게 적어보세요..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="writeIsRecommended" name="isRecommended">
                        <span class="checkmark"></span>
                        이 책을 다른 사람에게 추천하겠습니다
                    </label>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelWriteReview">취소</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> 리뷰 작성
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/data.js"></script>
    <script src="js/book-detail.js"></script>
</body>
</html>