<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookReview - ë‚˜ë§Œì˜ ë¶ ë¦¬ë·°</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“š BookReview</h1>
            <nav>
                <a href="index.html" class="active">í™ˆ</a>
                <a href="book_add.html">ì±… ì¶”ê°€</a>
                <div class="user-menu">
                    <span id="userGreeting" style="display: none;"></span>
                    <a href="login.html" id="loginBtn">ë¡œê·¸ì¸</a>
                    <a href="register.html" id="registerBtn">íšŒì›ê°€ì…</a>
                    <a href="#" id="logoutBtn" style="display: none;">ë¡œê·¸ì•„ì›ƒ</a>
                </div>
            </nav>
        </header>
        
        <main>
            <section class="hero">
                <h2>ğŸ“– ë‚˜ë§Œì˜ ë…ì„œ ê¸°ë¡ì„ ì‹œì‘í•´ë³´ì„¸ìš”</h2>
                <p>ì½ì€ ì±…ì˜ ê°ìƒì„ ê¸°ë¡í•˜ê³  ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ë¦¬ë·°ë„ í™•ì¸í•´ë³´ì„¸ìš”!</p>
            </section>
            
            <section class="search-section">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="ì±… ì œëª©ì´ë‚˜ ì €ìë¡œ ê²€ìƒ‰...">
                    <button id="searchBtn">ğŸ” ê²€ìƒ‰</button>
                </div>
            </section>
            
            <section id="book-list">
                <h2>ğŸ“š ë“±ë¡ëœ ì±…ë“¤</h2>
                <div id="books-container">
                    <!-- JavaScriptë¡œ ì±… ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </section>
            
            <section id="recent-reviews">
                <h2>â­ ìµœì‹  ë¦¬ë·°</h2>
                <div id="reviews-container">
                    <!-- JavaScriptë¡œ ë¦¬ë·° ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </section>
        </main>
        
        <footer>
            <p>&copy; 2025 BookReview. Made with â¤ï¸ by Team BookReview</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initMainPage();
            updateUserMenu();
            setupSearch();
        });
        
        function initMainPage() {
            initSampleData(); // ìƒ˜í”Œ ë°ì´í„° ì´ˆê¸°í™”
            displayBooks();
            displayRecentReviews();
        }
        
        function updateUserMenu() {
            const currentUser = getCurrentUser();
            const userGreeting = document.getElementById('userGreeting');
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (currentUser) {
                userGreeting.textContent = `ì•ˆë…•í•˜ì„¸ìš”, ${currentUser.name}ë‹˜! ğŸ‘‹`;
                userGreeting.style.display = 'inline';
                loginBtn.style.display = 'none';
                registerBtn.style.display = 'none';
                logoutBtn.style.display = 'inline';
            } else {
                userGreeting.style.display = 'none';
                loginBtn.style.display = 'inline';
                registerBtn.style.display = 'inline';
                logoutBtn.style.display = 'none';
            }
        }
        
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        }
        
        function performSearch() {
            const keyword = document.getElementById('searchInput').value.trim();
            const books = searchBooks(keyword);
            displayBooks(books);
        }
        
        function displayBooks(books = null) {
            if (!books) books = getBooks();
            
            const container = document.getElementById('books-container');
            
            if (books.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>ğŸ“ ë“±ë¡ëœ ì±…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p>ì²« ë²ˆì§¸ ì±…ì„ <a href="book_add.html">ì¶”ê°€</a>í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            books.forEach(book => {
                const reviews = getReviewsByBook(book.id);
                const avgRating = reviews.length > 0 ? 
                    (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1) : 0;
                
                html += `
                    <div class="book-card">
                        <div class="book-info">
                            <h3>${book.title}</h3>
                            <p class="author">ğŸ‘¤ ${book.author}</p>
                            <p class="publisher">ğŸ¢ ${book.publisher}</p>
                            <p class="genre">ğŸ·ï¸ ${book.genre}</p>
                            <div class="rating">
                                <span>${getStarRating(Math.round(avgRating))}</span>
                                <span class="rating-text">${avgRating}/5 (${reviews.length}ê°œ ë¦¬ë·°)</span>
                            </div>
                        </div>
                        <div class="book-actions">
                            <button onclick="viewBook(${book.id})" class="btn-primary">ğŸ“– ìƒì„¸ë³´ê¸°</button>
                            <button onclick="writeReview(${book.id})" class="btn-secondary">â­ ë¦¬ë·° ì“°ê¸°</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function displayRecentReviews() {
            const reviews = getRecentReviews(3);
            const container = document.getElementById('reviews-container');
            
            if (reviews.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>ğŸ“ ì•„ì§ ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p>ì²« ë²ˆì§¸ ë¦¬ë·°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            reviews.forEach(review => {
                const book = getBookById(review.bookId);
                html += `
                    <div class="review-card">
                        <div class="review-header">
                            <h4>ğŸ“– ${book ? book.title : 'ì•Œ ìˆ˜ ì—†ëŠ” ì±…'}</h4>
                            <div class="rating">${getStarRating(review.rating)}</div>
                        </div>
                        <div class="review-content">
                            <p>"${review.content}"</p>
                        </div>
                        <div class="review-footer">
                            <span class="reviewer">ğŸ‘¤ ${review.userName}</span>
                            <span class="review-date">ğŸ“… ${formatDate(review.reviewDate)}</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function viewBook(bookId) {
            // ì±… ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ (ì‹¤ì œë¡œëŠ” ë³„ë„ í˜ì´ì§€ë‚˜ ëª¨ë‹¬ë¡œ êµ¬í˜„)
            const book = getBookById(bookId);
            const reviews = getReviewsByBook(bookId);
            
            let reviewsHtml = '';
            reviews.forEach(review => {
                reviewsHtml += `
                    <div class="review-item">
                        <div>${getStarRating(review.rating)} - ${review.userName}</div>
                        <div>"${review.content}"</div>
                        <div class="review-date">${formatDate(review.reviewDate)}</div>
                    </div>
                `;
            });
            
            const modalHtml = `
                <div class="modal-overlay" onclick="closeModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <button class="modal-close" onclick="closeModal()">Ã—</button>
                        <h2>${book.title}</h2>
                        <p><strong>ì €ì:</strong> ${book.author}</p>
                        <p><strong>ì¶œíŒì‚¬:</strong> ${book.publisher}</p>
                        <p><strong>ì¥ë¥´:</strong> ${book.genre}</p>
                        <p><strong>ì„¤ëª…:</strong> ${book.description}</p>
                        <h3>ë¦¬ë·° (${reviews.length}ê°œ)</h3>
                        <div class="reviews-list">${reviewsHtml || 'ì•„ì§ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.'}</div>
                        <button onclick="writeReview(${bookId})" class="btn-primary">ë¦¬ë·° ì‘ì„±í•˜ê¸°</button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function writeReview(bookId) {
            const currentUser = getCurrentUser();
            if (!currentUser) {
                alert('ë¦¬ë·°ë¥¼ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }
            
            const book = getBookById(bookId);
            const rating = prompt(`"${book.title}"ì— ëŒ€í•œ í‰ì ì„ ì…ë ¥í•˜ì„¸ìš” (1-5):`);
            if (!rating || rating < 1 || rating > 5) {
                alert('ì˜¬ë°”ë¥¸ í‰ì (1-5)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const content = prompt('ë¦¬ë·° ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!content || content.trim() === '') {
                alert('ë¦¬ë·° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const newReview = addReview(bookId, rating, content.trim());
            if (newReview) {
                alert('ë¦¬ë·°ê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                displayBooks(); // í‰ì  ì—…ë°ì´íŠ¸ ë°˜ì˜
                displayRecentReviews();
                closeModal();
            } else {
                alert('ë¦¬ë·° ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }
        
        // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('logoutBtn').addEventListener('click', function(e) {
            e.preventDefault();
            logoutUser();
            updateUserMenu();
            alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
        });
    </script>
</body>
</html>